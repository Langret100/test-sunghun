<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ¬êµ¬ë‹¨ ê²Œì„ ğŸš€</title>
    <style>
        /*
         * CSS ìŠ¤íƒ€ì¼ë§
         */
        body {
            font-family: 'Arial', sans-serif;
            /* í™”ë©´ì„ ê½‰ ì±„ìš°ë„ë¡ ìˆ˜ì • */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* í—¤ë”ê°€ ìœ„ë¡œ ê°€ë„ë¡ */
            min-height: 100vh; /* ìµœì†Œ ë†’ì´ë¥¼ 100vhë¡œ ì„¤ì • */
            width: 100vw; /* ë„ˆë¹„ 100% */
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
            overflow: hidden;
            box-sizing: border-box; /* íŒ¨ë”©ê³¼ ë³´ë”ê°€ width/heightì— í¬í•¨ë˜ë„ë¡ */
        }
        #game-container {
            /* PC/ëª¨ë°”ì¼ ëª¨ë‘ í™”ë©´ ì „ì²´ë¥¼ ê½‰ ì±„ìš°ë„ë¡ ìˆ˜ì • */
            width: 100vw; 
            height: calc(100vh - 8vh); /* í—¤ë” ë†’ì´ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ê³µê°„ */
            position: relative;
            /* max-width ì œê±°: í™”ë©´ ì „ì²´ ì‚¬ìš© */
            border: 2px solid #333;
            background-color: #e0f2f7; /* ë°ì€ ë°°ê²½ */
            overflow: hidden;
            box-sizing: border-box;
        }
        #header {
            width: 100%;
            height: 8vh; /* í—¤ë” ë†’ì´ë¥¼ í™”ë©´ í¬ê¸°ì— ë¹„ë¡€í•˜ê²Œ ì„¤ì • */
            padding: 0 10px; /* ì¢Œìš° íŒ¨ë”© ì¶”ê°€ */
            background-color: #3f51b5;
            color: white;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-sizing: border-box;
        }
        #question {
            font-size: 2.2em;
            margin: 0;
        }
        #timer-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.8em;
        }
        #timer-bar-container {
            width: 100px; /* íƒ€ì´ë¨¸ ë°” ë„ˆë¹„ ì¡°ì • */
            height: 15px; /* íƒ€ì´ë¨¸ ë°” ë†’ì´ ì¡°ì • */
            background-color: #e0e0e0;
            border: 1px solid #ccc;
            margin-top: 5px;
        }
        #timer-bar {
            height: 100%;
            width: 100%;
            background-color: #ff9800;
            transition: width 0.1s linear;
        }
        /* ì•Œë¡ë‹¬ë¡í•œ ê³µ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .answer-ball {
            position: absolute;
            /* bottomì€ JSì—ì„œ ì„¤ì • (GROUND_HEIGHT - BALL_SIZE/2) */
            width: 84px; /* 70px * 1.2 = 84px */
            height: 84px; /* 70px * 1.2 = 84px */
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.1em; /* ê¸€ì”¨ í¬ê¸° 1.2ë°° */
            cursor: pointer;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.4); 
            transition: transform 0.1s; 
            z-index: 10;
            border: 2px solid rgba(255, 255, 255, 0.7); 
            will-change: bottom, transform;
            box-sizing: border-box; 
        }
        .answer-ball.answer-correct {
            background-color: #4CAF50 !important;
        }

        .answer-ball::before { 
            content: '';
            position: absolute;
            top: 6px; /* 5px * 1.2 = 6px */
            left: 6px; /* 5px * 1.2 = 6px */
            width: 60%;
            height: 60%;
            border-radius: 50%;
            background: radial-gradient(circle at top left, rgba(255,255,255,0.8), rgba(255,255,255,0));
            opacity: 0.7;
        }
        .answer-ball:hover {
            transform: scale(1.08); 
        }

        /* ë°”ë‹¥ ìŒ“ì¸ ê³µ í‘œí˜„ */
        #ground-pile {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%; /* í™”ë©´ ëì—ì„œ ëê¹Œì§€ ë°”êµ¬ë‹ˆ */
            height: 150px; /* ë°”êµ¬ë‹ˆ ë†’ì´ë¥¼ ì¡°ê¸ˆ ë‚®ì¶¤ */
            overflow: hidden;
            z-index: 0;
            background: linear-gradient(to top, #8d6e63, #a1887f);
            border-radius: 25px 25px 0 0;
            
        }
        #ground-pile::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 5%;
            width: 90%;
            height: 20px;
            border-radius: 15px;
            background: repeating-linear-gradient(
                45deg,
                rgba(255,255,255,0.7) 0,
                rgba(255,255,255,0.7) 10px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.1) 20px
            );
            
        }
        #ground-pile::after {
            content: '';
            position: absolute;
            bottom: 8px;
            left: 10%;
            width: 80%;
            height: 16px;
            border-radius: 10px;
            background: rgba(62,39,35,0.35);
        }
        .ground-pile-ball {
            position: absolute;
            border-radius: 50%;
            opacity: 0.6;
            box-shadow: inset 0 0 8px rgba(0,0,0,0.4); 
            border: 1px solid rgba(255, 255, 255, 0.5); 
            box-sizing: border-box;
            /* z-indexëŠ” JSì—ì„œ ëœë¤ìœ¼ë¡œ ë¶€ì—¬ë¨ */
        }

        /* ê²Œì„ ì˜¤ë²„/ì‹œì‘ í™”ë©´ ìŠ¤íƒ€ì¼ */
        #game-over-screen {
            position: fixed; /* ì „ì²´ í™”ë©´ì„ ë®ë„ë¡ fixedë¡œ ë³€ê²½ */
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.9); /* ë°°ê²½ìƒ‰ì„ ë” ì–´ë‘¡ê²Œ */
            color: white;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            z-index: 30; /* ê°€ì¥ ìœ„ë¡œ ì˜¬ë¦¼ */
            text-align: center;
        }
        #game-over-screen button {
            padding: 12px 25px; 
            font-size: 1em; 
            margin-top: 25px;
            cursor: pointer;
            border: none;
            background-color: #3f51b5;
            color: white;
            border-radius: 8px; 
            transition: background-color 0.3s, transform 0.1s;
        }
        #game-over-screen button:hover {
            background-color: #5c6bc0;
            transform: scale(1.05);
        }
        #current-limit {
            font-size: 0.8em;
            color: #ccc;
            margin-top: 5px;
        }
        /* ì¶”ê°€ëœ ì„¤ëª… ìŠ¤íƒ€ì¼ */
        #start-instruction {
            font-size: 1.2em;
            color: #ccc;
            margin-bottom: 15px; 
            font-weight: normal;
        }
        #game-title {
            font-size: 2.5em; 
            margin-bottom: 10px;
        }
        
        /* ëª¨ë°”ì¼ í™˜ê²½ ìµœì í™” */
        @media (max-width: 600px) {
            #game-container {
                height: calc(100vh - 60px); /* ëª¨ë°”ì¼ í—¤ë” ë†’ì´ë¥¼ ì•½ 60pxë¡œ ê°€ì • */
            }
            #header {
                height: 60px; /* ëª¨ë°”ì¼ í—¤ë” ë†’ì´ ê³ ì • */
                font-size: 1.2em;
            }
            #question {
                font-size: 1.8em; /* ëª¨ë°”ì¼ ì§ˆë¬¸ ê¸€ì”¨ í¬ê¸° ì¡°ì • */
            }
            .answer-ball {
                width: 72px; /* 60px * 1.2 = 72px */
                height: 72px;
                font-size: 1.8em; /* ê¸€ì”¨ í¬ê¸° 1.2ë°° */
            }
            #game-over-screen {
                font-size: 1.5em; /* ëª¨ë°”ì¼ ê²Œì„ ì˜¤ë²„ í™”ë©´ ê¸€ì”¨ í¬ê¸° ì¡°ì • */
            }
        }
    </style>
    <script src="../js/game-ghost.js"></script>

</head>
<body>

    <div id="header">
        <div>ì ìˆ˜: <span id="score">0</span></div>
        <div id="question">? x ? = ?</div>
        <div id="timer-display">
            ì œí•œ ì‹œê°„: <div id="timer-bar-container"><div id="timer-bar"></div></div>
            <div id="current-limit"></div>
        </div>
    </div>

    <div id="game-container">
        <div id="ground-pile"></div>
    </div>

    <div id="game-over-screen">
        <div id="game-title">
            êµ¬êµ¬ë‹¨ ê²Œì„
        </div>
        <div id="start-instruction">
            -ì •ë‹µì„ ì°¾ì•„ ëˆŒëŸ¬ìš”!-
        </div>
        <div id="final-score">ìµœì¢… ì ìˆ˜: 0</div>
        <button onclick="startGame()">ì‹œì‘</button>
    </div>

    <script src="../js/game-ranking-report.js"></script>
<script>
        //
        // JavaScript ê²Œì„ ë¡œì§
        //
        const INITIAL_DURATION = 5000;
        const DURATION_DECREMENT = 400;
        const DECREMENT_INTERVAL = 20;

        const BALL_SIZE = 84; 
        const GROUND_HEIGHT = 200; 
        const BALL_START_BOTTOM = GROUND_HEIGHT - (BALL_SIZE / 2); // ê³µì˜ ì¤‘ì‹¬ì´ ë°”ë‹¥ ìœ„ì— ìˆëŠ” ìœ„ì¹˜

        let currentLimit = INITIAL_DURATION;
        let currentScore = 0;
        let correctAnswer = 0;
        let isGameOver = true;
        let timerInterval;
        let questionTimeout;
        let activeBalls = []; // í˜„ì¬ í™”ë©´ì— ë–  ìˆëŠ” ê³µë“¤ì„ ê´€ë¦¬í•˜ëŠ” ë°°ì—´

        const gameContainer = document.getElementById('game-container');
        const questionElement = document.getElementById('question');
        const scoreElement = document.getElementById('score');
        const timerBar = document.getElementById('timer-bar');
        const gameOverScreen = document.getElementById('game-over-screen');
        const finalScoreElement = document.getElementById('final-score');
        const groundPile = document.getElementById('ground-pile');
        const currentLimitDisplay = document.getElementById('current-limit');
        
        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        function getRandomFactor() {
            return getRandomInt(1, 9);
        }
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[i], array[j]];
            }
            return array;
        }
        function getRandomColor() {
            const colors = [
                '#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5',
                '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50',
                '#8bc34a', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722'
            ];
            return colors[getRandomInt(0, colors.length - 1)];
        }

        // --- ê²Œì„ í•µì‹¬ ë¡œì§ ---

        function updateGameLimit() {
            if (currentScore > 0 && currentScore % DECREMENT_INTERVAL === 0) {
                currentLimit = Math.max(3000, currentLimit - DURATION_DECREMENT);
            }
            currentLimitDisplay.textContent = `ì œí•œ: ${(currentLimit / 1000).toFixed(1)}ì´ˆ`;
        }

        function newQuestion() {
            if (isGameOver) return;
            
            updateGameLimit();
            scoreElement.textContent = currentScore;

            const num1 = getRandomFactor();
            const num2 = getRandomFactor();
            correctAnswer = num1 * num2;
            questionElement.textContent = `${num1} x ${num2} = ?`;

            const answers = generateAnswers(correctAnswer);

            resetTimer();
            startTimer(currentLimit);

            // ê³µ ìƒì„± ë° ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            createBalls(answers);

            questionTimeout = setTimeout(() => {
                if (!isGameOver) {
                    endGame(false);
                }
            }, currentLimit);
        }

        function generateAnswers(correct) {
            const answers = [correct];
            const maxWrongAnswers = 4;
            let count = 0;

            while (count < maxWrongAnswers) {
                let wrong = getRandomInt(1, 81);
                if (wrong !== correct && !answers.includes(wrong)) {
                    answers.push(wrong);
                    count++;
                }
            }
            return shuffleArray(answers.slice(0, getRandomInt(4, 5)));
        }

        // ê³µ ìƒì„± ë° ì• ë‹ˆë©”ì´ì…˜ ì„¤ì • (ê²¹ì¹˜ì§€ ì•Šê²Œ ë°°ì¹˜ ë¡œì§ ë° ë¶€ìƒ ì• ë‹ˆë©”ì´ì…˜ ì ìš©)
        function createBalls(answers) {
            stopAllBalls(); // ê¸°ì¡´ ê³µ ëª¨ë‘ ì¤‘ì§€ ë° ì œê±°
            activeBalls = [];
            
            const containerWidth = gameContainer.clientWidth;
            const positions = []; // ì´ë¯¸ ë°°ì¹˜ëœ ê³µë“¤ì˜ x ìœ„ì¹˜ ì €ì¥
            const containerHeight = gameContainer.clientHeight;
            // BALL_START_BOTTOMì€ GROUND_HEIGHTì™€ BALL_SIZEì— ë”°ë¼ ê³„ì‚°ë¨
            const maxRiseHeight = containerHeight - BALL_START_BOTTOM + BALL_SIZE; // ê³µì´ í™”ë©´ ë°–ìœ¼ë¡œ ì™„ì „íˆ ë‚˜ê°ˆ ë†’ì´

            answers.forEach((ans, index) => {
                const ball = document.createElement('div');
                ball.classList.add('answer-ball');
                ball.textContent = ans;
                ball.dataset.value = ans;
                ball.style.backgroundColor = getRandomColor();
                
                // ê²¹ì¹˜ì§€ ì•Šê²Œ ê³µ ìœ„ì¹˜ ì°¾ê¸°
                let randomX;
                let isOverlapping;
                let attempts = 0;
                const minDistance = BALL_SIZE + 10; // ê³µ ê°„ì˜ ìµœì†Œ ê±°ë¦¬
                
                do {
                    isOverlapping = false;
                    randomX = getRandomInt(0, containerWidth - BALL_SIZE);

                    for (const pos of positions) {
                        if (Math.abs(randomX - pos) < minDistance) {
                            isOverlapping = true;
                            break;
                        }
                    }
                    attempts++;
                } while (isOverlapping && attempts < 100); // 100ë²ˆ ì‹œë„ í›„ì—ë„ ê²¹ì¹˜ë©´ ê·¸ëƒ¥ ë°°ì¹˜

                ball.style.left = `${randomX}px`;
                // ì‹œì‘ ìœ„ì¹˜: ë°”ë‹¥ ë°”ë¡œ ìœ„
                ball.style.bottom = `${BALL_START_BOTTOM}px`; 
                positions.push(randomX); // ë°°ì¹˜ëœ ìœ„ì¹˜ ê¸°ë¡

                ball.addEventListener('click', handleAnswerClick);
                gameContainer.appendChild(ball);
                activeBalls.push(ball);

                const duration = getRandomInt(4000, 7000); // ê³µì´ ìœ„ë¡œ ì˜¬ë¼ê°€ëŠ” ì´ ì‹œê°„
                
                // requestAnimationFrameì„ ì´ìš©í•œ ë¶€ìƒ ì• ë‹ˆë©”ì´ì…˜
                let animationFrameId;
                const startTime = performance.now();


                function animateBallUp(timestamp) {
                    if (isGameOver || !ball.parentElement) {
                        cancelAnimationFrame(animationFrameId);
                        return;
                    }
                    
                    const elapsed = timestamp - startTime;
                    // ì‹œê°„ì„ 0ë¶€í„° 1ê¹Œì§€ì˜ ë¹„ìœ¨ë¡œ ì •ê·œí™”
                    let progress = elapsed / duration; 

                    if (progress < 1) {
                        const newBottom = BALL_START_BOTTOM + maxRiseHeight * progress;
                        
                        ball.style.bottom = `${newBottom}px`;
                        animationFrameId = requestAnimationFrame(animateBallUp);
                    } else {
                        // í™”ë©´ ë°–ìœ¼ë¡œ ì™„ì „íˆ ì‚¬ë¼ì§ ì²˜ë¦¬
                        ball.removeEventListener('click', handleAnswerClick);
                        ball.remove();
                        activeBalls = activeBalls.filter(b => b !== ball);
                    }
                }
                ball.dataset.animationId = requestAnimationFrame(animateBallUp);
            });
        }

        function stopAllBalls() {
            activeBalls.forEach(ball => {
                const animationId = ball.dataset.animationId;
                if (animationId) {
                    cancelAnimationFrame(parseInt(animationId));
                }
                ball.removeEventListener('click', handleAnswerClick);
                ball.remove();
            });
            activeBalls = [];
        }

        // ì •ë‹µ ì‹œ ê³µë“¤ì„ ë–¨ì–´ëœ¨ë¦¬ëŠ” ì• ë‹ˆë©”ì´ì…˜ (ë°”ìš´ìŠ¤ ì—†ì´ ë‚™í•˜ í›„ í˜ì´ë“œì•„ì›ƒ)
        function dropAllBalls() {
            const ballsToDrop = [...activeBalls];
            activeBalls = [];
            
            const DROP_TIME = 400; // ë‚™í•˜ì— ê±¸ë¦¬ëŠ” ì‹œê°„ (0.4ì´ˆ)
            const FADE_TIME = 200; // í˜ì´ë“œì•„ì›ƒì— ê±¸ë¦¬ëŠ” ì‹œê°„ (0.2ì´ˆ)
            // ê³µì´ ì™„ì „íˆ ë©ˆì¶°ì•¼ í•  ë°”ë‹¥ ìœ„ì¹˜
            const targetBottom = BALL_START_BOTTOM; 

            ballsToDrop.forEach(ball => {
                const animationId = ball.dataset.animationId;
                if (animationId) {
                    cancelAnimationFrame(parseInt(animationId));
                }
                ball.removeEventListener('click', handleAnswerClick);

                // 1. ë‚™í•˜ ì¤€ë¹„: í˜„ì¬ ìœ„ì¹˜ì™€ ë‚™í•˜ ì†ì„± ì„¤ì •
                // cubic-bezier(0.3, 0.5, 0.5, 1)ëŠ” ì ì  ë¹¨ë¼ì§€ëŠ” ê°€ì† íš¨ê³¼ë¥¼ ì¤ë‹ˆë‹¤. (ì¤‘ë ¥ ëŠë‚Œ)
                ball.style.transition = `bottom ${DROP_TIME}ms cubic-bezier(0.3, 0.5, 0.5, 1)`; 
                
                // 2. ë‚™í•˜ ì‹¤í–‰
                ball.style.bottom = `${targetBottom}px`;

                // 3. ë‚™í•˜ ì™„ë£Œ í›„ í˜ì´ë“œì•„ì›ƒ ë° ì œê±°
                setTimeout(() => {
                    // bottom transitionì„ ë®ì–´ì“°ì§€ ì•Šê³  opacityì™€ transformì—ë§Œ ì ìš©
                    ball.style.transition = `opacity ${FADE_TIME}ms ease-out, transform ${FADE_TIME}ms ease-out`;
                    ball.style.opacity = '0';
                    ball.style.transform = 'scale(0.8)'; // ì‘ì•„ì§€ëŠ” íš¨ê³¼

                    // DOMì—ì„œ ìµœì¢… ì œê±°
                    setTimeout(() => {
                        ball.remove();
                    }, FADE_TIME);
                }, DROP_TIME);
            });
        }
        
        // --- íƒ€ì´ë¨¸ ë¡œì§ ---

        function resetTimer() {
            clearInterval(timerInterval);
            timerBar.style.width = '100%';
            timerBar.style.backgroundColor = '#ff9800';
        }

        function startTimer(duration) {
            let timeLeft = duration;
            const startTime = performance.now();

            timerInterval = setInterval(() => {
                const elapsedTime = performance.now() - startTime;
                timeLeft = duration - elapsedTime;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerBar.style.width = '0%';
                    endGame(false);
                    return;
                }

                const percentage = (timeLeft / duration) * 100;
                timerBar.style.width = `${percentage}%`;
                
                if (percentage < 25) {
                    timerBar.style.backgroundColor = '#f44336';
                } else if (percentage < 50) {
                    timerBar.style.backgroundColor = '#ffc107';
                }

            }, 50);
        }
        
        // --- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---

        function handleAnswerClick(event) {
            if (isGameOver) return;

            const selectedAnswer = parseInt(event.target.dataset.value);
            
            if (selectedAnswer === correctAnswer) {
                // [ì˜µì…˜] ê²Œì„ìš© ê³ ìŠ¤íŠ¸: ì •ë‹µ ë§ì·„ì„ ë•Œ ê¸°ì¨ í‘œí˜„
                if (window.gameGhostUI && typeof window.gameGhostUI.react === "function") {
                    try { window.gameGhostUI.react("correct"); } catch(e) {}
                }

                currentScore += 10;
                // ì •ë‹µ ê³µì€ ì´ˆë¡ìƒ‰ ê°•ì¡° í´ë˜ìŠ¤ ë¶€ì—¬
                event.target.classList.add('answer-correct');
                
                // ë‚˜ë¨¸ì§€ ê³µì˜ ì• ë‹ˆë©”ì´ì…˜ ë° íƒ€ì´ë¨¸ë¥¼ ì¤‘ì§€
                clearTimeout(questionTimeout);
                dropAllBalls(); // ê³µë“¤ì„ ë‚™í•˜ ë° í˜ì´ë“œì•„ì›ƒ ì‹œì‘
                
                // ê³µì´ ì‚¬ë¼ì§€ëŠ” ì‹œê°„ì„ ê³ ë ¤í•˜ì—¬ ë‹¤ìŒ ë¬¸ì œ ì‹œì‘ (0.4ì´ˆ ë‚™í•˜ + 0.2ì´ˆ í˜ì´ë“œì•„ì›ƒ)
                setTimeout(() => {
                    newQuestion();
                }, 700); // 0.7ì´ˆ í›„ ë‹¤ìŒ ë¬¸ì œ ì‹œì‘

            } else {
                event.target.style.backgroundColor = '#f44336';
                endGame(false);
            }
        }

        // --- ê²Œì„ ìƒíƒœ ê´€ë¦¬ ---

        function startGame() {
            // [ì˜µì…˜] ê²Œì„ìš© ê³ ìŠ¤íŠ¸: ê²Œì„ ì‹œì‘ ë°˜ì‘ (game-ghost.js ì‚­ì œ ì‹œ ì´ ë¸”ëŸ­ë„ í•¨ê»˜ ì‚­ì œ ê°€ëŠ¥)
            if (window.gameGhostUI && typeof window.gameGhostUI.react === "function") {
                try { window.gameGhostUI.react("start"); } catch(e) {}
            }

            currentLimit = INITIAL_DURATION;
            currentScore = 0;
            isGameOver = false;
            gameOverScreen.style.display = 'none';
            scoreElement.textContent = '0';
            
            clearInterval(timerInterval);
            clearTimeout(questionTimeout);
            stopAllBalls();
            
            newQuestion();
        }

        function endGame(isWin) {
            // âœ… ê²Œì„ ë­í‚¹ ì—°ë™: êµ¬êµ¬ë‹¨ê²Œì„ ì ìˆ˜ ì „ì†¡ (ë¶€ëª¨ ì°½ìœ¼ë¡œ ë©”ì‹œì§€ ì „ì†¡)
            try {
              if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                  type: "GAME_SCORE",
                  gameName: "êµ¬êµ¬ë‹¨ê²Œì„",
                  score: currentScore
                }, "*");
              }
            } catch(e) {}

            // [ì˜µì…˜] ê²Œì„ìš© ê³ ìŠ¤íŠ¸: ê²Œì„ ì˜¤ë²„/ì‹¤íŒ¨ ë°˜ì‘
            if (!isWin && window.gameGhostUI && typeof window.gameGhostUI.react === "function") {
                try { window.gameGhostUI.react("gameover"); } catch(e) {}
            }

            isGameOver = true;
            clearInterval(timerInterval);
            clearTimeout(questionTimeout);
            stopAllBalls();

            gameOverScreen.style.display = 'flex';
            document.getElementById('game-title').textContent = 'ê²Œì„ ì˜¤ë²„! ğŸ˜­';
            document.getElementById('start-instruction').style.display = 'none';
            finalScoreElement.textContent = `ìµœì¢… ì ìˆ˜: ${currentScore}`;
            gameOverScreen.querySelector('button').textContent = 'ë‹¤ì‹œ ì‹œì‘';
        }

        // ë°”ë‹¥ì— ìŒ“ì¸ ê³µ ì‹œê°ì  í‘œí˜„ ìƒì„± (ì•Œë¡ë‹¬ë¡, ê½‰ ì°¨ê²Œ)
        function createGroundPile() {
            // ì„±ëŠ¥ ê°œì„ ì„ ìœ„í•´ ë” ì´ìƒ ë°”ë‹¥ êµ¬ìŠ¬ DOMì„ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            // ë°”ë‹¥ì€ CSSë¡œë§Œ ë°”êµ¬ë‹ˆì²˜ëŸ¼ í‘œí˜„í•©ë‹ˆë‹¤.
        }

        // í˜ì´ì§€ ë¡œë“œ í›„ ê²Œì„ ì‹œì‘ ì•ˆë‚´ ë° ë°”ë‹¥ ê³µ ìƒì„±
        document.addEventListener('DOMContentLoaded', () => {
            gameOverScreen.style.display = 'flex';
            document.getElementById('game-title').textContent = 'êµ¬êµ¬ë‹¨ ê²Œì„';
            document.getElementById('start-instruction').style.display = 'block';
            finalScoreElement.textContent = '';
            gameOverScreen.querySelector('button').textContent = 'ì‹œì‘';
            
            // DOMContentLoaded ì‹œì ì—ëŠ” gameContainer í¬ê¸°ê°€ í™•ì •ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆì–´
            // resize ì´ë²¤íŠ¸ë‚˜, setTimeoutìœ¼ë¡œ ëŠ¦ê²Œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ë” ì•ˆì •ì ì…ë‹ˆë‹¤.
            setTimeout(createGroundPile, 100); 
        });

    </script>



</body>
</html>