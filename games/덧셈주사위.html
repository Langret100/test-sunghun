<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ì‚¬ìœ„ í•© ë§ì¶”ê¸° ê²Œì„</title>
    
    <style>
        /* CSS ì˜ì—­ (í™”ë©´ ê½‰ ì±„ì›€ìœ¼ë¡œ ìˆ˜ì •) */
        
        /* 1. HTML, BODYë¥¼ ë·°í¬íŠ¸ ì „ì²´ í¬ê¸°ë¡œ ì„¤ì • */
        html, body {
            width: 100%;
            height: 100%; /* ë·°í¬íŠ¸ ë†’ì´ 100% */
            margin: 0;
            padding: 0;
            overflow: hidden; /* ì „ì²´ ìŠ¤í¬ë¡¤ ë°©ì§€ */
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #game-container {
            /* 2. ê²Œì„ ì»¨í…Œì´ë„ˆë¥¼ ë¶€ëª¨(body) í¬ê¸°ì— ë§ê²Œ ê½‰ ì±„ì›€ */
            width: 100%;
            height: 100%; 
            /* PCì—ì„œë„ ë„ˆë¬´ ì»¤ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê±°ë‚˜, íŒ¨ë”©ì„ ì¡°ì •í•˜ì—¬ ì¤‘ì•™ ì§‘ì¤‘ì‹ìœ¼ë¡œ ìœ ì§€í•˜ë ¤ë©´ ì•„ë˜ ìŠ¤íƒ€ì¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. */
            /* max-width: 700px; max-height: 900px; */ 
            /* ìœ„ 2ì¤„ ëŒ€ì‹  ì•„ë˜ì²˜ëŸ¼ ì„¤ì •í•˜ì—¬ ê½‰ ì±„ì›€ */

            background-color: #fff;
            
            /* 3. ëª¨ë°”ì¼/PC ë°˜ì‘í˜• íŒ¨ë”© (ê°€ë¡œ/ì„¸ë¡œ ë¹„ìœ¨ì— ë”°ë¼ ì¡°ì ˆ) */
            padding: 5% 5%; /* 5%ì˜ ìƒí•˜ì¢Œìš° ì—¬ë°± */
            box-sizing: border-box; /* íŒ¨ë”©ì´ ì „ì²´ í¬ê¸°ì— í¬í•¨ë˜ë„ë¡ */

            border-radius: 0; /* í™”ë©´ ê½‰ ì±„ìš°ë¯€ë¡œ ëª¨ì„œë¦¬ ë‘¥ê¸€ê¸° ì œê±° */
            box-shadow: none; /* í™”ë©´ ê½‰ ì±„ìš°ë¯€ë¡œ ê·¸ë¦¼ì ì œê±° */
            text-align: center;
            position: relative;
            
            /* ì»¨í…ì¸ ê°€ ë„˜ì¹  ê²½ìš° ë‚´ë¶€ì—ì„œ ìŠ¤í¬ë¡¤ í—ˆìš© */
            overflow-y: auto; 
        }

        h1 {
            color: #333;
            margin-bottom: 15px; /* ëª¨ë°”ì¼ì—ì„œ ê³µê°„ í™•ë³´ */
            font-size: 1.8em;
        }

        /* -------------------- ì¸íŠ¸ë¡œ ë° ê²Œì„ ì˜¤ë²„ í™”ë©´ ê³µí†µ ìŠ¤íƒ€ì¼ -------------------- */
        .overlay-screen {
            position: fixed; /* ë·°í¬íŠ¸ ê¸°ì¤€ ì „ì²´ í™”ë©´ ë®ê¸° */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.98); /* ë°°ê²½ ë¶ˆíˆ¬ëª…ë„ ì•½ê°„ ë†’ì„ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            transition: opacity 0.5s ease-out;
            padding: 5%;
            box-sizing: border-box;
            border-radius: 0;
        }

        .overlay-screen h2 {
            font-size: 3em; /* í°íŠ¸ í¬ê¸° ì¡°ì • */
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .overlay-screen p {
            font-size: 1.2em; /* í°íŠ¸ í¬ê¸° ì¡°ì • */
            color: #555;
            margin: 15px 0 40px 0;
            line-height: 1.6;
        }

        .action-button {
            padding: 18px 35px; /* ë²„íŠ¼ í¬ê¸° í‚¤ì›€ */
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 22px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .action-button:hover {
            background-color: #27ae60;
        }
        
        /* ê²Œì„ ì˜¤ë²„ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        #gameover-message {
            font-size: 1.8em;
            color: #e74c3c;
            margin: 20px 0;
        }

        #final-score {
            font-size: 3em;
            font-weight: bold;
            color: #f39c12;
            margin-bottom: 30px;
        }
        /* -------------------------------------------------------- */


        #game-content {
            opacity: 0; 
            transition: opacity 0.5s ease-in;
            /* ë‚´ë¶€ ì»¨í…ì¸ ì˜ ìœ„ì¹˜ë¥¼ ì¡°ì •í•˜ê¸° ìœ„í•œ ì„¤ì • */
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* ìƒë‹¨ë¶€í„° ì±„ìš°ë„ë¡ */
        }

        /* ë‚˜ë¨¸ì§€ ê²Œì„ ìš”ì†Œ ìŠ¤íƒ€ì¼ ì¡°ì • */
        #dice-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 10px 0 20px 0;
            min-height: 100px; 
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
            /* ê½‰ ì°¬ í™”ë©´ì—ì„œ ì£¼ì‚¬ìœ„ ì»¨í…Œì´ë„ˆì˜ í¬ê¸° ì¡°ì •ì„ ìœ„í•œ ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
            max-width: 100%; 
            padding-bottom: 20px;
        }

        .dice-face {
            width: 60px; /* ì£¼ì‚¬ìœ„ í¬ê¸° ì•½ê°„ ì¶•ì†Œ (ë°˜ì‘í˜• ëŒ€ë¹„) */
            height: 60px;
            border: 2px solid #333;
            border-radius: 6px;
            box-shadow: 0 3px #ccc;
            /* ë‚˜ë¨¸ì§€ ì†ì„± ìœ ì§€ */
            background-color: #ffffff;
            background-size: cover;
            background-position: center;
            transition: transform 0.1s ease-out;
            position: absolute;
            opacity: 0;
        }
        
        @keyframes fallAndRoll {
            /* (ê¸°ì¡´ fallAndRoll ì• ë‹ˆë©”ì´ì…˜ ìœ ì§€) */
            0% { transform: translateY(-200px) rotateZ(0deg) scale(0.8); opacity: 0; }
            30% { transform: translateY(-50px) rotateZ(180deg) scale(1.1); opacity: 1; }
            70% { transform: translateY(20px) rotateZ(360deg) scale(0.9); opacity: 1; }
            100% { transform: translateY(0) rotateZ(720deg) scale(1); opacity: 1; }
        }
        .dice-fall {
            animation: fallAndRoll 0.8s ease-out forwards;
        }


        #options-container {
            display: flex; justify-content: center; gap: 5%; margin: 15px 0;
            width: 100%; /* ì˜µì…˜ ì»¨í…Œì´ë„ˆë¥¼ ë„“ê²Œ ì‚¬ìš© */
            max-width: 500px;
        }
        .option-button {
            padding: 15px 10px; /* ë²„íŠ¼ íŒ¨ë”© ì¡°ì • */
            background-color: #f39c12; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 1.1em; /* í°íŠ¸ í¬ê¸° ì¡°ì • */
            font-weight: bold; 
            transition: background-color 0.3s; 
            flex-grow: 1; /* ê°€ë¡œ ê³µê°„ ì±„ìš°ê¸° */
            width: auto; /* width: 80px ì œê±° */
            min-width: 60px;
        }
        .option-button:hover:not(:disabled) { background-color: #e67e22; }
        .option-button:disabled { background-color: #cccccc; cursor: not-allowed; }
        
        #round-info { font-size: 1.1em; margin-bottom: 5px; }
        #timer { font-size: 1.6em; color: #e74c3c; font-weight: bold; margin: 10px 0; }
        #question { margin-top: 10px; font-size: 1.2em; font-weight: bold; }
        #message { font-size: 1.3em; min-height: 40px; margin-bottom: 15px; font-weight: bold; }
        #score-board { 
            margin-top: 20px; 
            padding: 10px; 
            border: 1px dashed #95a5a6; 
            border-radius: 5px; 
            width: 90%; 
            max-width: 400px;
        }
        #score-board h2 { font-size: 1.5em; margin: 5px 0; }
        #score-board p { font-size: 1em; margin: 5px 0; }
        
        
        /* ì£¼ì‚¬ìœ„ ëˆˆê¸ˆ SVG Data URI: (ê¸°ì¡´ ì½”ë“œ ìœ ì§€) */
        .d1 { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23ffffff' rx='10'/%3E%3Ccircle cx='50' cy='50' r='12' fill='%23000000'/%3E%3C/svg%3E"); }
        .d2 { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23ffffff' rx='10'/%3E%3Ccircle cx='25' cy='25' r='12' fill='%23000000'/%3E%3Ccircle cx='75' cy='75' r='12' fill='%23000000'/%3E%3C/svg%3E"); }
        .d3 { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23ffffff' rx='10'/%3E%3Ccircle cx='25' cy='75' r='12' fill='%23000000'/%3E%3Ccircle cx='50' cy='50' r='12' fill='%23000000'/%3E%3Ccircle cx='75' cy='25' r='12' fill='%23000000'/%3E%3C/svg%3E"); }
        .d4 { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23ffffff' rx='10'/%3E%3Ccircle cx='25' cy='25' r='12' fill='%23000000'/%3E%3Ccircle cx='75' cy='25' r='12' fill='%23000000'/%3E%3Ccircle cx='25' cy='75' r='12' fill='%23000000'/%3E%3Ccircle cx='75' cy='75' r='12' fill='%23000000'/%3E%3C/svg%3E"); }
        .d5 { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23ffffff' rx='10'/%3E%3Ccircle cx='25' cy='25' r='12' fill='%23000000'/%3E%3Ccircle cx='75' cy='25' r='12' fill='%23000000'/%3E%3Ccircle cx='50' cy='50' r='12' fill='%23000000'/%3E%3Ccircle cx='25' cy='75' r='12' fill='%23000000'/%3E%3Ccircle cx='75' cy='75' r='12' fill='%23000000'/%3E%3C/svg%3E"); }
        .d6 { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23ffffff' rx='10'/%3E%3Ccircle cx='25' cy='25' r='12' fill='%23000000'/%3E%3Ccircle cx='75' cy='25' r='12' fill='%23000000'/%3E%3Ccircle cx='25' cy='50' r='12' fill='%23000000'/%3E%3Ccircle cx='75' cy='50' r='12' fill='%23000000'/%3E%3Ccircle cx='25' cy='75' r='12' fill='%23000000'/%3E%3Ccircle cx='75' cy='75' r='12' fill='%23000000'/%3E%3C/svg%3E"); }
    </style>
    <script src="../js/game-ghost.js"></script>

</head>
<body>
    <div id="game-container">
        
        <div id="intro-screen" class="overlay-screen">
            <h2>ğŸ² ì£¼ì‚¬ìœ„ í•© ë§ì¶”ê¸° ë§ˆìŠ¤í„° ğŸ²</h2>
            <p>
                ì£¼ì‚¬ìœ„ ëˆˆê¸ˆì˜ í•©ì„ ë§íˆëŠ” ê°ê´€ì‹ ê²Œì„ì…ë‹ˆë‹¤.<br>
                ë§¤ ë¼ìš´ë“œ ì£¼ì‚¬ìœ„ê°€ êµ´ëŸ¬ ë–¨ì–´ì§€ë©° ëˆˆê¸ˆì´ ê²°ì •ë©ë‹ˆë‹¤.<br>
                **3ë¼ìš´ë“œ**ë§ˆë‹¤ ì£¼ì‚¬ìœ„ ê°œìˆ˜ê°€ í•˜ë‚˜ì”© ëŠ˜ì–´ë‚˜ ë‚œì´ë„ê°€ ìƒìŠ¹í•©ë‹ˆë‹¤.<br>
                ì œí•œì‹œê°„ **6ì´ˆ** ì•ˆì— ì •ë‹µì„ ì„ íƒí•˜ì„¸ìš”!
            </p>
            <button id="intro-button" class="action-button" onclick="startGame(true)">ê²Œì„ ì‹œì‘</button>
        </div>
        <div id="game-over-screen" class="overlay-screen" style="display: none;">
            <h2>ğŸš¨ ê²Œì„ ì˜¤ë²„ ğŸš¨</h2>
            <p id="gameover-message"></p>
            <p>ìµœì¢… ì ìˆ˜:</p>
            <div id="final-score">0</div>
            <button id="restart-button" class="action-button" onclick="startGame(true)">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
        <div id="game-content">
            <h1>ğŸ² ì£¼ì‚¬ìœ„ í•© ë§ì¶”ê¸° ğŸ²</h1>
            <p id="round-info">í˜„ì¬ ë¼ìš´ë“œ: 0 | ì£¼ì‚¬ìœ„ ê°œìˆ˜: 2</p>
            
            <div id="dice-container">
                </div>

            <p id="timer">ë‚¨ì€ ì‹œê°„: 6ì´ˆ</p>
            
            <p id="question">ì£¼ì‚¬ìœ„ ëˆˆê¸ˆì˜ í•©ì€?</p>
            <div id="options-container">
                </div>
            
            <p id="message"></p>
            
            <div id="score-board">
                <h2>ì ìˆ˜: <span id="score">0</span></h2>
                <p>ì •ë‹µ: <span id="correct-count">0</span> / ì˜¤ë‹µ: <span id="wrong-count">0</span></p>
            </div>
        </div>
    </div>

    <script src="../js/game-ranking-report.js"></script>
<script>
        // JavaScript ì˜ì—­ì€ ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤.
        let currentRound = 0;
        let diceCount = 2; 
        let correctSum = 0;
        let score = 0;
        let correctCount = 0;
        let wrongCount = 0;
        const TIME_LIMIT = 6;
        let timeLeft = TIME_LIMIT;
        let timerInterval;
        let gameActive = false;

        // DOM ìš”ì†Œ
        const introScreen = document.getElementById('intro-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const gameContent = document.getElementById('game-content');
        const roundInfo = document.getElementById('round-info');
        const diceContainer = document.getElementById('dice-container');
        const optionsContainer = document.getElementById('options-container');
        const timerDisplay = document.getElementById('timer');
        const messageDisplay = document.getElementById('message');
        const scoreDisplay = document.getElementById('score');
        const correctCountDisplay = document.getElementById('correct-count');
        const wrongCountDisplay = document.getElementById('wrong-count');
        const finalScoreDisplay = document.getElementById('final-score');
        const gameoverMessageDisplay = document.getElementById('gameover-message');


        /** ëœë¤ ì£¼ì‚¬ìœ„ ëˆˆê¸ˆ êµ´ë¦¬ê¸° (1~6) */
        function rollDice() {
            return Math.floor(Math.random() * 6) + 1;
        }

        /** ì£¼ì‚¬ìœ„ ëˆˆê¸ˆ ì´ë¯¸ì§€ í´ë˜ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. */
        function getDiceClass(value) {
            return `d${value}`;
        }

        /**
         * ê²Œì„ ì‹œì‘/ì¬ì‹œì‘ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
         * @param {boolean} isNewGame - ìƒˆ ê²Œì„ì¸ì§€ ì—¬ë¶€
         */
        function startGame(isNewGame) {
            // [ì˜µì…˜] ê²Œì„ìš© ê³ ìŠ¤íŠ¸: ê²Œì„ ì‹œì‘ ë°˜ì‘ (game-ghost.js ì‚­ì œ ì‹œ ì´ ë¸”ëŸ­ë„ í•¨ê»˜ ì‚­ì œ ê°€ëŠ¥)
            if (window.gameGhostUI && typeof window.gameGhostUI.react === "function") {
                try { window.gameGhostUI.react("start"); } catch(e) {}
            }
            // ì˜¤ë²„ë ˆì´ í™”ë©´ ìˆ¨ê¸°ê¸°
            introScreen.style.opacity = '0';
            gameOverScreen.style.opacity = '0';
            
            setTimeout(() => {
                introScreen.style.display = 'none';
                gameOverScreen.style.display = 'none';
                gameContent.style.opacity = '1';
                
                if (isNewGame) {
                    // ìƒˆ ê²Œì„ ì‹œì‘ ì‹œ ë³€ìˆ˜ ì´ˆê¸°í™”
                    currentRound = 0; 
                    score = 0;
                    correctCount = 0;
                    wrongCount = 0;
                    updateScoreBoard();
                    nextRound();
                }
            }, 500);
        }
        
        /** ê²Œì„ ì˜¤ë²„ë¥¼ ì²˜ë¦¬í•˜ê³  í™”ë©´ì„ í‘œì‹œí•©ë‹ˆë‹¤. */
        function endGame(reason) {
            // âœ… ê²Œì„ ë­í‚¹ ì—°ë™: ë§ì…ˆì£¼ì‚¬ìœ„ ì ìˆ˜ ì „ì†¡ (ë¶€ëª¨ ì°½ìœ¼ë¡œ ë©”ì‹œì§€ ì „ì†¡)
            try {
              if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                  type: "GAME_SCORE",
                  gameName: "ë§ì…ˆì£¼ì‚¬ìœ„",
                  score: score
                }, "*");
              }
            } catch(e) {}

            // [ì˜µì…˜] ê²Œì„ìš© ê³ ìŠ¤íŠ¸: ê²Œì„ ì˜¤ë²„/ì‹¤íŒ¨ ë°˜ì‘
            if (window.gameGhostUI && typeof window.gameGhostUI.react === "function") {
                try { window.gameGhostUI.react("gameover"); } catch(e) {}
            }
            clearInterval(timerInterval);
            gameActive = false;
            disableOptions(true);
            
            // ê²Œì„ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
            gameContent.style.opacity = '0';
            
            // ê²Œì„ ì˜¤ë²„ í™”ë©´ í‘œì‹œ
            finalScoreDisplay.textContent = score;
            gameoverMessageDisplay.textContent = reason;
            gameOverScreen.style.display = 'flex';
            
            setTimeout(() => {
                gameOverScreen.style.opacity = '1';
            }, 10);
        }


        /** ë‹¤ìŒ ë¼ìš´ë“œë¥¼ ì¤€ë¹„í•˜ê³  ì‹œì‘í•©ë‹ˆë‹¤. */
        function nextRound() {
            currentRound++;
            
            // 3ë¼ìš´ë“œë§ˆë‹¤ ì£¼ì‚¬ìœ„ ê°œìˆ˜ +1
            diceCount = Math.floor((currentRound - 1) / 3) + 2; 
            
            roundInfo.textContent = `í˜„ì¬ ë¼ìš´ë“œ: ${currentRound} | ì£¼ì‚¬ìœ„ ê°œìˆ˜: ${diceCount}`;
            
            startRound();
        }

        /** ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦¬ê³  í™”ë©´ì— í‘œì‹œí•˜ë©° ì •ë‹µì„ ê³„ì‚°í•˜ê³  ë³´ê¸°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. */
        function startRound() {
            if (gameActive) return;

            correctSum = 0;
            messageDisplay.textContent = '';
            gameActive = true;
            disableOptions(true); 

            diceContainer.innerHTML = '';

            const diceValues = [];
            for (let i = 0; i < diceCount; i++) {
                const value = rollDice();
                diceValues.push(value);
                correctSum += value;
            }

            // 1. ì£¼ì‚¬ìœ„ ë–¨ì–´ì§€ëŠ” ì—°ì¶œ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
            diceValues.forEach((value, index) => {
                const diceElement = document.createElement('div');
                diceElement.className = `dice-face ${getDiceClass(value)}`;
                
                                // ì£¼ì‚¬ìœ„ ë°°ì¹˜ë¥¼ í™”ë©´ í¬ê¸°ì— ë§ê²Œ ì¡°ì •
                const containerWidth = diceContainer.offsetWidth;
                const DICE_SIZE_WITH_GAP = 75; // ì£¼ì‚¬ìœ„ í¬ê¸° + ê°„ê²©
                const ROW_MAX = 4;            // í•œ ì¤„ì— ìµœëŒ€ 4ê°œ ë°°ì¹˜

                let startX, topY;

                if (diceCount <= ROW_MAX) {
                    // ROW_MAX(ìµœëŒ€ 4ê°œ) ì´í•˜ì¼ ë•ŒëŠ” í•œ ì¤„ì— ë‚˜ë€íˆ ì¤‘ì•™ ì •ë ¬
                    const totalDiceWidth = diceCount * 60 + (diceCount - 1) * 15;
                    startX = (containerWidth - totalDiceWidth) / 2 + (index * DICE_SIZE_WITH_GAP);
                    topY = 0;
                } else {
                    // ROW_MAX+1ê°œ(ì˜ˆ: 5ê°œ) ì´ìƒì¼ ë•ŒëŠ” ìµœëŒ€ 4ê°œì”© ì—¬ëŸ¬ ì¤„ ë°°ì¹˜ (ì˜ˆ: 5ê°œë©´ 4/1)
                    const col = index % ROW_MAX;
                    const row = Math.floor(index / ROW_MAX);
                    const totalRowWidth = ROW_MAX * 60 + (ROW_MAX - 1) * 15;
                    const baseX = (containerWidth - totalRowWidth) / 2;
                    startX = baseX + col * DICE_SIZE_WITH_GAP;
                    topY = row * 80; // ì¤„ ê°„ ì„¸ë¡œ ê°„ê²©
                }

                diceElement.style.left = `${startX}px`;
                diceElement.style.top = `${topY}px`; 
                diceElement.style.animationDelay = `${index * 0.1}s`; 

                diceContainer.appendChild(diceElement);

                setTimeout(() => {
                    diceElement.classList.add('dice-fall');
                }, 50 + index * 100);
            });

            // ëª¨ë“  ì£¼ì‚¬ìœ„ ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚œ í›„ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰
            const totalAnimationTime = (diceCount - 1) * 0.1 + 0.8 + 0.2; 
            
            setTimeout(() => {
                setupOptions();
                disableOptions(false); 
                startTimer();

            }, totalAnimationTime * 1000); 
        }

        /** 5ê°œì˜ ë³´ê¸° ë²„íŠ¼ì„ ì„¤ì •í•©ë‹ˆë‹¤. */
        function setupOptions() {
            optionsContainer.innerHTML = '';
            
            const options = generateOptions(correctSum, diceCount);
            
            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option;
                button.onclick = () => checkAnswer(option);
                optionsContainer.appendChild(button);
            });
        }

        /** ì •ë‹µê³¼ 4ê°œì˜ ì˜¤ë‹µì„ í¬í•¨í•œ 5ê°œì˜ ë³´ê¸°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ê¸°ì¡´ ë¡œì§ ìœ ì§€) */
        function generateOptions(correctAnswer, count) {
            const minSum = count * 1;
            const maxSum = count * 6;
            const options = new Set();
            options.add(correctAnswer);
            // ... (ìƒëµëœ ë¡œì§) ...
            while (options.size < 5) {
                let randomOffset = Math.floor(Math.random() * 5) + 1; 
                if (Math.random() < 0.5) randomOffset *= -1; 

                let newOption = correctAnswer + randomOffset;
                
                if (newOption < minSum) newOption = minSum;
                if (newOption > maxSum) newOption = maxSum;
                
                if (newOption !== correctAnswer) {
                     options.add(newOption);
                }
            }
            let optionArray = Array.from(options);
            for (let i = optionArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [optionArray[i], optionArray[j]] = [optionArray[j], optionArray[i]];
            }
            return optionArray;
        }

        /** ë³´ê¸° ë²„íŠ¼ì˜ í™œì„±í™”/ë¹„í™œì„±í™”ë¥¼ ì œì–´í•©ë‹ˆë‹¤. */
        function disableOptions(disabled) {
            const buttons = optionsContainer.querySelectorAll('.option-button');
            buttons.forEach(button => {
                button.disabled = disabled;
                button.style.opacity = disabled ? 0.5 : 1.0;
            });
        }

        /** ì œí•œì‹œê°„ íƒ€ì´ë¨¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. */
        function startTimer() {
            timeLeft = TIME_LIMIT;
            timerDisplay.textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;
            clearInterval(timerInterval);

            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeout();
                }
            }, 1000);
        }

        /** ì‹œê°„ ì´ˆê³¼ ì‹œ ì²˜ë¦¬ ë¡œì§ì…ë‹ˆë‹¤. */
        function handleTimeout() {
            if (!gameActive) return; 
            endGame("ì‹œê°„ ì´ˆê³¼ë¡œ ì¸í•´ ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        }

        /** ì‚¬ìš©ì ì„ íƒ ì •ë‹µì„ í™•ì¸í•©ë‹ˆë‹¤. */
        function checkAnswer(selectedAnswer) {
            if (!gameActive) return;

            clearInterval(timerInterval);
            gameActive = false;
            disableOptions(true); 

            const answer = parseInt(selectedAnswer, 10);
            const buttons = optionsContainer.querySelectorAll('.option-button');

            buttons.forEach(button => {
                const buttonValue = parseInt(button.textContent, 10);
                if (buttonValue === correctSum) {
                    button.style.backgroundColor = '#2ecc71';
                } else if (buttonValue === answer && answer !== correctSum) {
                    button.style.backgroundColor = '#e74c3c';
                }
            });

            if (answer === correctSum) {
                // [ì˜µì…˜] ê²Œì„ìš© ê³ ìŠ¤íŠ¸: ì •ë‹µ ë§ì·„ì„ ë•Œ ê¸°ì¨ í‘œí˜„
                if (window.gameGhostUI && typeof window.gameGhostUI.react === "function") {
                    try { window.gameGhostUI.react("correct"); } catch(e) {}
                }
                messageDisplay.textContent = "âœ… ì •ë‹µì…ë‹ˆë‹¤! ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.";
                score += 10;
                correctCount++;
                updateScoreBoard();
                setTimeout(nextRound, 2000);
            } else {
                messageDisplay.textContent = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. ì •ë‹µì€ ${correctSum}ì´ì—ˆìŠµë‹ˆë‹¤.`;
                wrongCount++;
                updateScoreBoard();
                
                // ì˜¤ë‹µ ì‹œ ê²Œì„ ì˜¤ë²„
                setTimeout(() => {
                    endGame("ì •ë‹µì„ ë§íˆì§€ ëª»í•˜ì—¬ ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
                }, 1500);
            }
        }

        /** ì ìˆ˜íŒì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. */
        function updateScoreBoard() {
            scoreDisplay.textContent = score;
            correctCountDisplay.textContent = correctCount;
            wrongCountDisplay.textContent = wrongCount;
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸íŠ¸ë¡œ í™”ë©´ë§Œ ë³´ì´ë„ë¡ ì„¤ì •
        window.onload = function() {
             gameContent.style.opacity = '0';
             introScreen.style.display = 'flex';
        };
    </script>



</body>
</html>